import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import bodyParser from 'body-parser';
import path from 'path';
import errorHandler from './src/middleware/errorHandler.ts'; // Custom error handling middleware
import { securityHeaders, securityLogger, generalRateLimit } from './src/middleware/security.ts';
import authRoutes from './src/routes/auth.ts';
import courseRoutes from './src/routes/courses.ts';
import enrollmentRoutes from './src/routes/enrollments.ts';
import adminRoutes from './src/routes/admin.ts';
import userRoutes from './src/routes/users.ts';
import uploadRoutes from './src/routes/upload.ts';
import healthRoutes from './src/routes/health.ts';
import pdfRoutes from './src/routes/pdf.ts';
const app = express();
// Middleware
app.use(securityHeaders); // Custom security headers
app.use(securityLogger); // Security logging
app.use(generalRateLimit); // General rate limiting
app.use(cors()); // Enable CORS
app.use(helmet()); // Security middleware
app.use(bodyParser.json({ limit: '10mb' })); // JSON parsing
app.use(bodyParser.urlencoded({ extended: true })); // Form data parsing
// Serve static files from uploads directory
app.use('/uploads', express.static(path.join(process.cwd(), 'uploads')));
// Routes
app.use('/api/auth', authRoutes);
app.use('/api/courses', courseRoutes);
app.use('/api/enrollments', enrollmentRoutes);
app.use('/api/admin', adminRoutes);
app.use('/api/users', userRoutes);
app.use('/api/upload', uploadRoutes);
app.use('/api', healthRoutes);
app.use('/api/pdf', pdfRoutes);
// Error handling middleware
app.use(errorHandler);
export default app;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sT0FBTyxNQUFNLFNBQVMsQ0FBQztBQUM5QixPQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFDeEIsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sVUFBVSxNQUFNLGFBQWEsQ0FBQztBQUNyQyxPQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFDeEIsT0FBTyxZQUFZLE1BQU0sa0NBQWtDLENBQUMsQ0FBQyxtQ0FBbUM7QUFDaEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxjQUFjLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNqRyxPQUFPLFVBQVUsTUFBTSxzQkFBc0IsQ0FBQztBQUM5QyxPQUFPLFlBQVksTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLGdCQUFnQixNQUFNLDZCQUE2QixDQUFDO0FBQzNELE9BQU8sV0FBVyxNQUFNLHVCQUF1QixDQUFDO0FBQ2hELE9BQU8sVUFBVSxNQUFNLHVCQUF1QixDQUFDO0FBQy9DLE9BQU8sWUFBWSxNQUFNLHdCQUF3QixDQUFDO0FBQ2xELE9BQU8sWUFBWSxNQUFNLHdCQUF3QixDQUFDO0FBQ2xELE9BQU8sU0FBUyxNQUFNLHFCQUFxQixDQUFDO0FBRTVDLE1BQU0sR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDO0FBRXRCLGFBQWE7QUFDYixHQUFHLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsMEJBQTBCO0FBQ3BELEdBQUcsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7QUFDNUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsd0JBQXdCO0FBQ25ELEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWM7QUFDL0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsc0JBQXNCO0FBQ3pDLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlO0FBQzVELEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxvQkFBb0I7QUFFeEUsNENBQTRDO0FBQzVDLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRXpFLFNBQVM7QUFDVCxHQUFHLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQztBQUNqQyxHQUFHLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxZQUFZLENBQUMsQ0FBQztBQUN0QyxHQUFHLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLGdCQUFnQixDQUFDLENBQUM7QUFDOUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDbkMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLENBQUM7QUFDbEMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDLENBQUM7QUFDckMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLENBQUM7QUFDOUIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFFL0IsNEJBQTRCO0FBQzVCLEdBQUcsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFdEIsZUFBZSxHQUFHLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IGNvcnMgZnJvbSAnY29ycyc7XHJcbmltcG9ydCBoZWxtZXQgZnJvbSAnaGVsbWV0JztcclxuaW1wb3J0IGJvZHlQYXJzZXIgZnJvbSAnYm9keS1wYXJzZXInO1xyXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcclxuaW1wb3J0IGVycm9ySGFuZGxlciBmcm9tICcuL3NyYy9taWRkbGV3YXJlL2Vycm9ySGFuZGxlci50cyc7IC8vIEN1c3RvbSBlcnJvciBoYW5kbGluZyBtaWRkbGV3YXJlXHJcbmltcG9ydCB7IHNlY3VyaXR5SGVhZGVycywgc2VjdXJpdHlMb2dnZXIsIGdlbmVyYWxSYXRlTGltaXQgfSBmcm9tICcuL3NyYy9taWRkbGV3YXJlL3NlY3VyaXR5LnRzJztcclxuaW1wb3J0IGF1dGhSb3V0ZXMgZnJvbSAnLi9zcmMvcm91dGVzL2F1dGgudHMnO1xyXG5pbXBvcnQgY291cnNlUm91dGVzIGZyb20gJy4vc3JjL3JvdXRlcy9jb3Vyc2VzLnRzJztcclxuaW1wb3J0IGVucm9sbG1lbnRSb3V0ZXMgZnJvbSAnLi9zcmMvcm91dGVzL2Vucm9sbG1lbnRzLnRzJztcclxuaW1wb3J0IGFkbWluUm91dGVzIGZyb20gJy4vc3JjL3JvdXRlcy9hZG1pbi50cyc7XHJcbmltcG9ydCB1c2VyUm91dGVzIGZyb20gJy4vc3JjL3JvdXRlcy91c2Vycy50cyc7XHJcbmltcG9ydCB1cGxvYWRSb3V0ZXMgZnJvbSAnLi9zcmMvcm91dGVzL3VwbG9hZC50cyc7XHJcbmltcG9ydCBoZWFsdGhSb3V0ZXMgZnJvbSAnLi9zcmMvcm91dGVzL2hlYWx0aC50cyc7XHJcbmltcG9ydCBwZGZSb3V0ZXMgZnJvbSAnLi9zcmMvcm91dGVzL3BkZi50cyc7XHJcblxyXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XHJcblxyXG4vLyBNaWRkbGV3YXJlXHJcbmFwcC51c2Uoc2VjdXJpdHlIZWFkZXJzKTsgLy8gQ3VzdG9tIHNlY3VyaXR5IGhlYWRlcnNcclxuYXBwLnVzZShzZWN1cml0eUxvZ2dlcik7IC8vIFNlY3VyaXR5IGxvZ2dpbmdcclxuYXBwLnVzZShnZW5lcmFsUmF0ZUxpbWl0KTsgLy8gR2VuZXJhbCByYXRlIGxpbWl0aW5nXHJcbmFwcC51c2UoY29ycygpKTsgLy8gRW5hYmxlIENPUlNcclxuYXBwLnVzZShoZWxtZXQoKSk7IC8vIFNlY3VyaXR5IG1pZGRsZXdhcmVcclxuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oeyBsaW1pdDogJzEwbWInIH0pKTsgLy8gSlNPTiBwYXJzaW5nXHJcbmFwcC51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpOyAvLyBGb3JtIGRhdGEgcGFyc2luZ1xyXG5cclxuLy8gU2VydmUgc3RhdGljIGZpbGVzIGZyb20gdXBsb2FkcyBkaXJlY3RvcnlcclxuYXBwLnVzZSgnL3VwbG9hZHMnLCBleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3VwbG9hZHMnKSkpO1xyXG5cclxuLy8gUm91dGVzXHJcbmFwcC51c2UoJy9hcGkvYXV0aCcsIGF1dGhSb3V0ZXMpO1xyXG5hcHAudXNlKCcvYXBpL2NvdXJzZXMnLCBjb3Vyc2VSb3V0ZXMpO1xyXG5hcHAudXNlKCcvYXBpL2Vucm9sbG1lbnRzJywgZW5yb2xsbWVudFJvdXRlcyk7XHJcbmFwcC51c2UoJy9hcGkvYWRtaW4nLCBhZG1pblJvdXRlcyk7XHJcbmFwcC51c2UoJy9hcGkvdXNlcnMnLCB1c2VyUm91dGVzKTtcclxuYXBwLnVzZSgnL2FwaS91cGxvYWQnLCB1cGxvYWRSb3V0ZXMpO1xyXG5hcHAudXNlKCcvYXBpJywgaGVhbHRoUm91dGVzKTtcclxuYXBwLnVzZSgnL2FwaS9wZGYnLCBwZGZSb3V0ZXMpO1xyXG5cclxuLy8gRXJyb3IgaGFuZGxpbmcgbWlkZGxld2FyZVxyXG5hcHAudXNlKGVycm9ySGFuZGxlcik7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhcHA7XHJcbiJdfQ==