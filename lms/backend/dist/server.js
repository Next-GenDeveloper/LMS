import { connectMongoDB, connectPostgreSQL } from './src/config/database.ts';
import { ENV } from './src/config/env.ts';
import https from 'https';
import fs from 'fs';
const PORT = ENV.PORT || 5000;
async function bootstrap() {
    await connectMongoDB();
    if (ENV.USE_POSTGRES) {
        await connectPostgreSQL();
    }
    else {
        console.log('â„¹ï¸ Skipping PostgreSQL connection (USE_POSTGRES is false)');
    }
    // Seed admin account
    const { seedAdmin } = await import('./src/utils/seedAdmin.ts');
    await seedAdmin();
    const { default: app } = await import('./app.ts');
    // Check for SSL certificates
    const sslKeyPath = process.env.SSL_KEY_PATH;
    const sslCertPath = process.env.SSL_CERT_PATH;
    if (sslKeyPath && sslCertPath && fs.existsSync(sslKeyPath) && fs.existsSync(sslCertPath)) {
        // HTTPS server
        const sslOptions = {
            key: fs.readFileSync(sslKeyPath),
            cert: fs.readFileSync(sslCertPath),
        };
        const httpsServer = https.createServer(sslOptions, app);
        httpsServer.listen(PORT, () => {
            console.log(`ðŸ”’ HTTPS Server is running on port ${PORT}`);
        });
    }
    else {
        // HTTP server (development)
        app.listen(PORT, () => {
            console.log(`ðŸŒ HTTP Server is running on port ${PORT}`);
            if (ENV.NODE_ENV === 'production') {
                console.warn('âš ï¸  WARNING: Running in production without HTTPS! Configure SSL certificates.');
            }
        });
    }
}
bootstrap().catch((err) => {
    console.error('Failed to start server', err);
    process.exit(1);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDMUMsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBRTFCLE9BQU8sRUFBRSxNQUFNLElBQUksQ0FBQztBQUdwQixNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQztBQUU5QixLQUFLLFVBQVUsU0FBUztJQUNwQixNQUFNLGNBQWMsRUFBRSxDQUFDO0lBQ3ZCLElBQUksR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ25CLE1BQU0saUJBQWlCLEVBQUUsQ0FBQztJQUM5QixDQUFDO1NBQU0sQ0FBQztRQUNKLE9BQU8sQ0FBQyxHQUFHLENBQUMsMkRBQTJELENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBRUQscUJBQXFCO0lBQ3JCLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxNQUFNLE1BQU0sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBQy9ELE1BQU0sU0FBUyxFQUFFLENBQUM7SUFFbEIsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUVsRCw2QkFBNkI7SUFDN0IsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUM7SUFDNUMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUM7SUFFOUMsSUFBSSxVQUFVLElBQUksV0FBVyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1FBQ3ZGLGVBQWU7UUFDZixNQUFNLFVBQVUsR0FBRztZQUNmLEdBQUcsRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQztZQUNoQyxJQUFJLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7U0FDckMsQ0FBQztRQUVGLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3hELFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRTtZQUMxQixPQUFPLENBQUMsR0FBRyxDQUFDLHNDQUFzQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztTQUFNLENBQUM7UUFDSiw0QkFBNEI7UUFDNUIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFO1lBQ2xCLE9BQU8sQ0FBQyxHQUFHLENBQUMscUNBQXFDLElBQUksRUFBRSxDQUFDLENBQUM7WUFDekQsSUFBSSxHQUFHLENBQUMsUUFBUSxLQUFLLFlBQVksRUFBRSxDQUFDO2dCQUNoQyxPQUFPLENBQUMsSUFBSSxDQUFDLCtFQUErRSxDQUFDLENBQUM7WUFDbEcsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztBQUNMLENBQUM7QUFFRCxTQUFTLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtJQUN0QixPQUFPLENBQUMsS0FBSyxDQUFDLHdCQUF3QixFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzdDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDcEIsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25uZWN0TW9uZ29EQiwgY29ubmVjdFBvc3RncmVTUUwgfSBmcm9tICcuL3NyYy9jb25maWcvZGF0YWJhc2UudHMnO1xyXG5pbXBvcnQgeyBFTlYgfSBmcm9tICcuL3NyYy9jb25maWcvZW52LnRzJztcclxuaW1wb3J0IGh0dHBzIGZyb20gJ2h0dHBzJztcclxuaW1wb3J0IGh0dHAgZnJvbSAnaHR0cCc7XHJcbmltcG9ydCBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuY29uc3QgUE9SVCA9IEVOVi5QT1JUIHx8IDUwMDA7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBib290c3RyYXAoKSB7XHJcbiAgICBhd2FpdCBjb25uZWN0TW9uZ29EQigpO1xyXG4gICAgaWYgKEVOVi5VU0VfUE9TVEdSRVMpIHtcclxuICAgICAgICBhd2FpdCBjb25uZWN0UG9zdGdyZVNRTCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmxvZygn4oS577iPIFNraXBwaW5nIFBvc3RncmVTUUwgY29ubmVjdGlvbiAoVVNFX1BPU1RHUkVTIGlzIGZhbHNlKScpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNlZWQgYWRtaW4gYWNjb3VudFxyXG4gICAgY29uc3QgeyBzZWVkQWRtaW4gfSA9IGF3YWl0IGltcG9ydCgnLi9zcmMvdXRpbHMvc2VlZEFkbWluLnRzJyk7XHJcbiAgICBhd2FpdCBzZWVkQWRtaW4oKTtcclxuXHJcbiAgICBjb25zdCB7IGRlZmF1bHQ6IGFwcCB9ID0gYXdhaXQgaW1wb3J0KCcuL2FwcC50cycpO1xyXG5cclxuICAgIC8vIENoZWNrIGZvciBTU0wgY2VydGlmaWNhdGVzXHJcbiAgICBjb25zdCBzc2xLZXlQYXRoID0gcHJvY2Vzcy5lbnYuU1NMX0tFWV9QQVRIO1xyXG4gICAgY29uc3Qgc3NsQ2VydFBhdGggPSBwcm9jZXNzLmVudi5TU0xfQ0VSVF9QQVRIO1xyXG5cclxuICAgIGlmIChzc2xLZXlQYXRoICYmIHNzbENlcnRQYXRoICYmIGZzLmV4aXN0c1N5bmMoc3NsS2V5UGF0aCkgJiYgZnMuZXhpc3RzU3luYyhzc2xDZXJ0UGF0aCkpIHtcclxuICAgICAgICAvLyBIVFRQUyBzZXJ2ZXJcclxuICAgICAgICBjb25zdCBzc2xPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBrZXk6IGZzLnJlYWRGaWxlU3luYyhzc2xLZXlQYXRoKSxcclxuICAgICAgICAgICAgY2VydDogZnMucmVhZEZpbGVTeW5jKHNzbENlcnRQYXRoKSxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBodHRwc1NlcnZlciA9IGh0dHBzLmNyZWF0ZVNlcnZlcihzc2xPcHRpb25zLCBhcHApO1xyXG4gICAgICAgIGh0dHBzU2VydmVyLmxpc3RlbihQT1JULCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5SSIEhUVFBTIFNlcnZlciBpcyBydW5uaW5nIG9uIHBvcnQgJHtQT1JUfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBIVFRQIHNlcnZlciAoZGV2ZWxvcG1lbnQpXHJcbiAgICAgICAgYXBwLmxpc3RlbihQT1JULCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4yQIEhUVFAgU2VydmVyIGlzIHJ1bm5pbmcgb24gcG9ydCAke1BPUlR9YCk7XHJcbiAgICAgICAgICAgIGlmIChFTlYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gIFdBUk5JTkc6IFJ1bm5pbmcgaW4gcHJvZHVjdGlvbiB3aXRob3V0IEhUVFBTISBDb25maWd1cmUgU1NMIGNlcnRpZmljYXRlcy4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5ib290c3RyYXAoKS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc3RhcnQgc2VydmVyJywgZXJyKTtcclxuICAgIHByb2Nlc3MuZXhpdCgxKTtcclxufSk7XHJcbiJdfQ==