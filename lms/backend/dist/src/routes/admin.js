import { Router } from 'express';
import { requireAuth, requireRole } from '../middleware/auth.ts';
import { User } from '../models/User.ts';
import { Course } from '../models/Course.ts';
import { Enrollment } from '../models/Enrollment.ts';
import { Announcement } from '../models/Announcement.ts';
import { hashPassword, comparePassword } from '../utils/Passwordhash.ts';
const router = Router();
router.get('/', requireAuth, requireRole('admin'), (req, res) => {
    res.json({ message: 'Admin endpoint', user: req.user });
});
router.get('/stats', requireAuth, requireRole('admin'), async (_req, res) => {
    try {
        const [users, courses, enrollments] = await Promise.all([
            User.countDocuments({ role: 'student' }),
            Course.countDocuments({}),
            Enrollment.find({ paymentStatus: 'completed' }).populate('course', 'price'),
        ]);
        // Calculate revenue from completed enrollments
        const revenue = enrollments.reduce((sum, enrollment) => {
            return sum + (enrollment.course?.price || 0);
        }, 0);
        res.json({ users, courses, revenue });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to fetch stats' });
    }
});
router.get('/enrollments', requireAuth, requireRole('admin'), async (_req, res) => {
    try {
        const recentEnrollments = await Enrollment.find({})
            .populate('student', 'firstName lastName email')
            .populate('course', 'title thumbnail price')
            .sort({ enrollmentDate: -1 })
            .limit(10);
        res.json({ enrollments: recentEnrollments });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to fetch enrollments' });
    }
});
router.get('/courses', requireAuth, requireRole('admin'), async (_req, res) => {
    try {
        const courses = await Course.find({})
            .sort({ createdAt: -1 });
        res.json({ courses });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to fetch courses' });
    }
});
// Users management
router.get('/users', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { page = 1, limit = 10, search = '' } = req.query;
        const skip = (Number(page) - 1) * Number(limit);
        const query = search ? {
            $or: [
                { firstName: { $regex: search, $options: 'i' } },
                { lastName: { $regex: search, $options: 'i' } },
                { email: { $regex: search, $options: 'i' } }
            ]
        } : {};
        const users = await User.find(query)
            .select('-password')
            .sort({ createdAt: -1 })
            .skip(skip)
            .limit(Number(limit));
        const total = await User.countDocuments(query);
        res.json({ users, total, page: Number(page), pages: Math.ceil(total / Number(limit)) });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to fetch users' });
    }
});
// Create new user (admin only)
router.post('/users', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { firstName, lastName, email, password, role = 'student', phone, bio } = req.body;
        // Check if user already exists
        const existingUser = await User.findOne({ email: email.toLowerCase().trim() });
        if (existingUser) {
            return res.status(400).json({ message: 'User with this email already exists' });
        }
        // Hash password
        const hashedPassword = await hashPassword(password);
        const user = new User({
            firstName: firstName.trim(),
            lastName: lastName.trim(),
            email: email.toLowerCase().trim(),
            password: hashedPassword,
            role,
            phone: phone?.trim(),
            bio: bio?.trim(),
            isVerified: true, // Admin-created users are auto-verified
        });
        await user.save();
        // Return user without password
        const userResponse = await User.findById(user._id).select('-password');
        res.status(201).json({ user: userResponse });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to create user' });
    }
});
// Get single user details (admin only)
router.get('/users/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        const user = await User.findById(id).select('-password');
        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }
        res.json({ user });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to fetch user' });
    }
});
// Update user (admin only)
router.put('/users/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        const { firstName, lastName, email, role, phone, bio, isVerified } = req.body;
        const updateData = {
            firstName: firstName?.trim(),
            lastName: lastName?.trim(),
            role,
            phone: phone?.trim(),
            bio: bio?.trim(),
            isVerified,
        };
        // Only update email if it's changed and doesn't conflict
        if (email && email.toLowerCase().trim() !== (await User.findById(id)).email) {
            const existingUser = await User.findOne({
                email: email.toLowerCase().trim(),
                _id: { $ne: id }
            });
            if (existingUser) {
                return res.status(400).json({ message: 'Email already in use by another user' });
            }
            updateData.email = email.toLowerCase().trim();
        }
        const user = await User.findByIdAndUpdate(id, updateData, { new: true }).select('-password');
        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }
        res.json({ user });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to update user' });
    }
});
// Delete user (admin only)
router.delete('/users/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        // Prevent deleting admin users
        const user = await User.findById(id);
        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }
        if (user.role === 'admin') {
            return res.status(400).json({ message: 'Cannot delete admin users' });
        }
        await User.findByIdAndDelete(id);
        res.json({ message: 'User deleted successfully' });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to delete user' });
    }
});
// Create new user (admin only)
router.post('/users', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { email, firstName, lastName, password, role = 'student', phone, bio } = req.body;
        // Check if user already exists
        const existingUser = await User.findOne({ email });
        if (existingUser) {
            return res.status(400).json({ message: 'User with this email already exists' });
        }
        // Hash password
        const hashedPassword = await hashPassword(password);
        const user = new User({
            email,
            firstName,
            lastName,
            password: hashedPassword,
            role,
            phone,
            bio,
            preferences: {
                interests: [],
                preferredLanguage: 'en',
                notifications: true
            }
        });
        await user.save();
        // Return user without password
        const userResponse = await User.findById(user._id).select('-password');
        res.status(201).json({ user: userResponse });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to create user' });
    }
});
// Update user by ID (admin only)
router.put('/users/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        const { email, firstName, lastName, role, phone, bio, preferences } = req.body;
        const updateData = {};
        if (email !== undefined)
            updateData.email = email;
        if (firstName !== undefined)
            updateData.firstName = firstName;
        if (lastName !== undefined)
            updateData.lastName = lastName;
        if (role !== undefined)
            updateData.role = role;
        if (phone !== undefined)
            updateData.phone = phone;
        if (bio !== undefined)
            updateData.bio = bio;
        if (preferences !== undefined)
            updateData.preferences = preferences;
        const user = await User.findByIdAndUpdate(id, updateData, { new: true, runValidators: true }).select('-password');
        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }
        res.json({ user });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to update user' });
    }
});
// Delete user by ID (admin only)
router.delete('/users/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        // Prevent deleting admin users
        const user = await User.findById(id);
        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }
        if (user.role === 'admin') {
            return res.status(400).json({ message: 'Cannot delete admin users' });
        }
        await User.findByIdAndDelete(id);
        res.json({ message: 'User deleted successfully' });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to delete user' });
    }
});
// Get single user by ID (admin only)
router.get('/users/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        const user = await User.findById(id).select('-password');
        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }
        res.json({ user });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to fetch user' });
    }
});
// Course CRUD
router.post('/courses', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { title, description, thumbnail, category, price, level, duration, language, tags, modules } = req.body;
        const user = req.user;
        const course = new Course({
            title,
            description,
            thumbnail,
            category,
            price: Number(price),
            level,
            duration: Number(duration),
            language,
            tags: tags || [],
            modules: modules || [],
            isPublished: true
        });
        await course.save();
        res.status(201).json({ course });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to create course' });
    }
});
router.put('/courses/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        const updates = req.body;
        const course = await Course.findByIdAndUpdate(id, updates, { new: true });
        if (!course) {
            return res.status(404).json({ message: 'Course not found' });
        }
        res.json({ course });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to update course' });
    }
});
router.delete('/courses/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        await Course.findByIdAndDelete(id);
        res.json({ message: 'Course deleted successfully' });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to delete course' });
    }
});
// Enrollments/Payments
router.get('/enrollments', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { page = 1, limit = 10 } = req.query;
        const skip = (Number(page) - 1) * Number(limit);
        const enrollments = await Enrollment.find({})
            .populate('student', 'firstName lastName email')
            .populate('course', 'title price')
            .sort({ enrollmentDate: -1 })
            .skip(skip)
            .limit(Number(limit));
        const total = await Enrollment.countDocuments();
        res.json({ enrollments, total, page: Number(page), pages: Math.ceil(total / Number(limit)) });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to fetch enrollments' });
    }
});
// Announcements
router.get('/announcements', requireAuth, requireRole('admin'), async (_req, res) => {
    try {
        const announcements = await Announcement.find({})
            .populate('createdBy', 'firstName lastName')
            .sort({ createdAt: -1 });
        res.json({ announcements });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to fetch announcements' });
    }
});
router.post('/announcements', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { title, message, type } = req.body;
        const user = req.user;
        const announcement = new Announcement({
            title,
            message,
            type: type || 'info',
            createdBy: user.userId
        });
        await announcement.save();
        res.status(201).json({ announcement });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to create announcement' });
    }
});
router.put('/announcements/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        const { title, message, type, isActive } = req.body;
        const announcement = await Announcement.findByIdAndUpdate(id, {
            title,
            message,
            type,
            isActive
        }, { new: true });
        if (!announcement) {
            return res.status(404).json({ message: 'Announcement not found' });
        }
        res.json({ announcement });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to update announcement' });
    }
});
router.delete('/announcements/:id', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { id } = req.params;
        await Announcement.findByIdAndDelete(id);
        res.json({ message: 'Announcement deleted successfully' });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to delete announcement' });
    }
});
// Settings - Change password
router.put('/settings/password', requireAuth, requireRole('admin'), async (req, res) => {
    try {
        const { currentPassword, newPassword } = req.body;
        const user = req.user;
        const adminUser = await User.findById(user.userId);
        if (!adminUser) {
            return res.status(404).json({ message: 'User not found' });
        }
        const isMatch = await comparePassword(currentPassword, adminUser.password);
        if (!isMatch) {
            return res.status(400).json({ message: 'Current password is incorrect' });
        }
        const hashed = await hashPassword(newPassword);
        adminUser.password = hashed;
        await adminUser.save();
        res.json({ message: 'Password updated successfully' });
    }
    catch (e) {
        res.status(500).json({ message: e.message || 'Failed to update password' });
    }
});
export default router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRtaW4uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcm91dGVzL2FkbWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFakMsT0FBTyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDekMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN6RSxNQUFNLE1BQU0sR0FBRyxNQUFNLEVBQUUsQ0FBQztBQUV4QixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxXQUFXLEVBQUUsV0FBVyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsR0FBWSxFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQ2pGLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxFQUFHLEdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQ25FLENBQUMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsV0FBVyxFQUFFLFdBQVcsQ0FBQyxPQUFPLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBYSxFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQzdGLElBQUksQ0FBQztRQUNILE1BQU0sQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLFdBQVcsQ0FBQyxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQztZQUN0RCxJQUFJLENBQUMsY0FBYyxD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QUFFLCtCQUErQixFQUFFLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztRQUNoQixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLDJCQUEyQixFQUFFLENBQUMsQ0FBQztJQUM5RSxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSCxlQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgdHlwZSB7IFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCB7IHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSB9IGZyb20gJy4uL21pZGRsZXdhcmUvYXV0aC50cyc7XHJcbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuLi9tb2RlbHMvVXNlci50cyc7XHJcbmltcG9ydCB7IENvdXJzZSB9IGZyb20gJy4uL21vZGVscy9Db3Vyc2UudHMnO1xyXG5pbXBvcnQgeyBFbnJvbGxtZW50IH0gZnJvbSAnLi4vbW9kZWxzL0Vucm9sbG1lbnQudHMnO1xyXG5pbXBvcnQgeyBBbm5vdW5jZW1lbnQgfSBmcm9tICcuLi9tb2RlbHMvQW5ub3VuY2VtZW50LnRzJztcclxuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCBjb21wYXJlUGFzc3dvcmQgfSBmcm9tICcuLi91dGlscy9QYXNzd29yZGhhc2gudHMnO1xyXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcclxuXHJcbnJvdXRlci5nZXQoJy8nLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICByZXMuanNvbih7IG1lc3NhZ2U6ICdBZG1pbiBlbmRwb2ludCcsIHVzZXI6IChyZXEgYXMgYW55KS51c2VyIH0pO1xyXG59KTtcclxuXHJcbnJvdXRlci5nZXQoJy9zdGF0cycsIHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSgnYWRtaW4nKSwgYXN5bmMgKF9yZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgW3VzZXJzLCBjb3Vyc2VzLCBlbnJvbGxtZW50c10gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgIFVzZXIuY291bnREb2N1bWVudHMoeyByb2xlOiAnc3R1ZGVudCcgfSksXHJcbiAgICAgIENvdXJzZS5jb3VudERvY3VtZW50cyh7fSksXHJcbiAgICAgIEVucm9sbG1lbnQuZmluZCh7IHBheW1lbnRTdGF0dXM6ICdjb21wbGV0ZWQnIH0pLnBvcHVsYXRlKCdjb3Vyc2UnLCAncHJpY2UnKSxcclxuICAgIF0pO1xyXG4gICAgXHJcbiAgICAvLyBDYWxjdWxhdGUgcmV2ZW51ZSBmcm9tIGNvbXBsZXRlZCBlbnJvbGxtZW50c1xyXG4gICAgY29uc3QgcmV2ZW51ZSA9IGVucm9sbG1lbnRzLnJlZHVjZSgoc3VtLCBlbnJvbGxtZW50OiBhbnkpID0+IHtcclxuICAgICAgcmV0dXJuIHN1bSArIChlbnJvbGxtZW50LmNvdXJzZT8ucHJpY2UgfHwgMCk7XHJcbiAgICB9LCAwKTtcclxuICAgIFxyXG4gICAgcmVzLmpzb24oeyB1c2VycywgY291cnNlcywgcmV2ZW51ZSB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2ggc3RhdHMnIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG5yb3V0ZXIuZ2V0KCcvZW5yb2xsbWVudHMnLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIGFzeW5jIChfcmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlY2VudEVucm9sbG1lbnRzID0gYXdhaXQgRW5yb2xsbWVudC5maW5kKHt9KVxyXG4gICAgICAucG9wdWxhdGUoJ3N0dWRlbnQnLCAnZmlyc3ROYW1lIGxhc3ROYW1lIGVtYWlsJylcclxuICAgICAgLnBvcHVsYXRlKCdjb3Vyc2UnLCAndGl0bGUgdGh1bWJuYWlsIHByaWNlJylcclxuICAgICAgLnNvcnQoeyBlbnJvbGxtZW50RGF0ZTogLTEgfSlcclxuICAgICAgLmxpbWl0KDEwKTtcclxuICAgIFxyXG4gICAgcmVzLmpzb24oeyBlbnJvbGxtZW50czogcmVjZW50RW5yb2xsbWVudHMgfSk7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGUubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGZldGNoIGVucm9sbG1lbnRzJyB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxucm91dGVyLmdldCgnL2NvdXJzZXMnLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIGFzeW5jIChfcmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGNvdXJzZXMgPSBhd2FpdCBDb3Vyc2UuZmluZCh7fSlcclxuICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pO1xyXG5cclxuICAgIHJlcy5qc29uKHsgY291cnNlcyB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2ggY291cnNlcycgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIFVzZXJzIG1hbmFnZW1lbnRcclxucm91dGVyLmdldCgnL3VzZXJzJywgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlKCdhZG1pbicpLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcGFnZSA9IDEsIGxpbWl0ID0gMTAsIHNlYXJjaCA9ICcnIH0gPSByZXEucXVlcnk7XHJcbiAgICBjb25zdCBza2lwID0gKE51bWJlcihwYWdlKSAtIDEpICogTnVtYmVyKGxpbWl0KTtcclxuXHJcbiAgICBjb25zdCBxdWVyeSA9IHNlYXJjaCA/IHtcclxuICAgICAgJG9yOiBbXHJcbiAgICAgICAgeyBmaXJzdE5hbWU6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9LFxyXG4gICAgICAgIHsgbGFzdE5hbWU6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9LFxyXG4gICAgICAgIHsgZW1haWw6IHsgJHJlZ2V4OiBzZWFyY2gsICRvcHRpb25zOiAnaScgfSB9XHJcbiAgICAgIF1cclxuICAgIH0gOiB7fTtcclxuXHJcbiAgICBjb25zdCB1c2VycyA9IGF3YWl0IFVzZXIuZmluZChxdWVyeSlcclxuICAgICAgLnNlbGVjdCgnLXBhc3N3b3JkJylcclxuICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pXHJcbiAgICAgIC5za2lwKHNraXApXHJcbiAgICAgIC5saW1pdChOdW1iZXIobGltaXQpKTtcclxuXHJcbiAgICBjb25zdCB0b3RhbCA9IGF3YWl0IFVzZXIuY291bnREb2N1bWVudHMocXVlcnkpO1xyXG5cclxuICAgIHJlcy5qc29uKHsgdXNlcnMsIHRvdGFsLCBwYWdlOiBOdW1iZXIocGFnZSksIHBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBOdW1iZXIobGltaXQpKSB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2ggdXNlcnMnIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBDcmVhdGUgbmV3IHVzZXIgKGFkbWluIG9ubHkpXHJcbnJvdXRlci5wb3N0KCcvdXNlcnMnLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBmaXJzdE5hbWUsIGxhc3ROYW1lLCBlbWFpbCwgcGFzc3dvcmQsIHJvbGUgPSAnc3R1ZGVudCcsIHBob25lLCBiaW8gfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBleGlzdHNcclxuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKSB9KTtcclxuICAgIGlmIChleGlzdGluZ1VzZXIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBIYXNoIHBhc3N3b3JkXHJcbiAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChwYXNzd29yZCk7XHJcblxyXG4gICAgY29uc3QgdXNlciA9IG5ldyBVc2VyKHtcclxuICAgICAgZmlyc3ROYW1lOiBmaXJzdE5hbWUudHJpbSgpLFxyXG4gICAgICBsYXN0TmFtZTogbGFzdE5hbWUudHJpbSgpLFxyXG4gICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCksXHJcbiAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcclxuICAgICAgcm9sZSxcclxuICAgICAgcGhvbmU6IHBob25lPy50cmltKCksXHJcbiAgICAgIGJpbzogYmlvPy50cmltKCksXHJcbiAgICAgIGlzVmVyaWZpZWQ6IHRydWUsIC8vIEFkbWluLWNyZWF0ZWQgdXNlcnMgYXJlIGF1dG8tdmVyaWZpZWRcclxuICAgIH0pO1xyXG5cclxuICAgIGF3YWl0IHVzZXIuc2F2ZSgpO1xyXG5cclxuICAgIC8vIFJldHVybiB1c2VyIHdpdGhvdXQgcGFzc3dvcmRcclxuICAgIGNvbnN0IHVzZXJSZXNwb25zZSA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlci5faWQpLnNlbGVjdCgnLXBhc3N3b3JkJyk7XHJcbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7IHVzZXI6IHVzZXJSZXNwb25zZSB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gY3JlYXRlIHVzZXInIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBHZXQgc2luZ2xlIHVzZXIgZGV0YWlscyAoYWRtaW4gb25seSlcclxucm91dGVyLmdldCgnL3VzZXJzLzppZCcsIHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSgnYWRtaW4nKSwgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQoaWQpLnNlbGVjdCgnLXBhc3N3b3JkJyk7XHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyB9KTtcclxuICAgIH1cclxuICAgIHJlcy5qc29uKHsgdXNlciB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2ggdXNlcicgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIFVwZGF0ZSB1c2VyIChhZG1pbiBvbmx5KVxyXG5yb3V0ZXIucHV0KCcvdXNlcnMvOmlkJywgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlKCdhZG1pbicpLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBjb25zdCB7IGZpcnN0TmFtZSwgbGFzdE5hbWUsIGVtYWlsLCByb2xlLCBwaG9uZSwgYmlvLCBpc1ZlcmlmaWVkIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7XHJcbiAgICAgIGZpcnN0TmFtZTogZmlyc3ROYW1lPy50cmltKCksXHJcbiAgICAgIGxhc3ROYW1lOiBsYXN0TmFtZT8udHJpbSgpLFxyXG4gICAgICByb2xlLFxyXG4gICAgICBwaG9uZTogcGhvbmU/LnRyaW0oKSxcclxuICAgICAgYmlvOiBiaW8/LnRyaW0oKSxcclxuICAgICAgaXNWZXJpZmllZCxcclxuICAgIH07XHJcblxyXG4gICAgLy8gT25seSB1cGRhdGUgZW1haWwgaWYgaXQncyBjaGFuZ2VkIGFuZCBkb2Vzbid0IGNvbmZsaWN0XHJcbiAgICBpZiAoZW1haWwgJiYgZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCkgIT09IChhd2FpdCBVc2VyLmZpbmRCeUlkKGlkKSkuZW1haWwpIHtcclxuICAgICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgVXNlci5maW5kT25lKHtcclxuICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKS50cmltKCksXHJcbiAgICAgICAgX2lkOiB7ICRuZTogaWQgfVxyXG4gICAgICB9KTtcclxuICAgICAgaWYgKGV4aXN0aW5nVXNlcikge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdFbWFpbCBhbHJlYWR5IGluIHVzZSBieSBhbm90aGVyIHVzZXInIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIHVwZGF0ZURhdGEuZW1haWwgPSBlbWFpbC50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZEFuZFVwZGF0ZShpZCwgdXBkYXRlRGF0YSwgeyBuZXc6IHRydWUgfSkuc2VsZWN0KCctcGFzc3dvcmQnKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcy5qc29uKHsgdXNlciB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gdXBkYXRlIHVzZXInIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBEZWxldGUgdXNlciAoYWRtaW4gb25seSlcclxucm91dGVyLmRlbGV0ZSgnL3VzZXJzLzppZCcsIHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSgnYWRtaW4nKSwgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG5cclxuICAgIC8vIFByZXZlbnQgZGVsZXRpbmcgYWRtaW4gdXNlcnNcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKGlkKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKHVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnQ2Fubm90IGRlbGV0ZSBhZG1pbiB1c2VycycgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgVXNlci5maW5kQnlJZEFuZERlbGV0ZShpZCk7XHJcbiAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdVc2VyIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZGVsZXRlIHVzZXInIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBDcmVhdGUgbmV3IHVzZXIgKGFkbWluIG9ubHkpXHJcbnJvdXRlci5wb3N0KCcvdXNlcnMnLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBlbWFpbCwgZmlyc3ROYW1lLCBsYXN0TmFtZSwgcGFzc3dvcmQsIHJvbGUgPSAnc3R1ZGVudCcsIHBob25lLCBiaW8gfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBleGlzdHNcclxuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IGVtYWlsIH0pO1xyXG4gICAgaWYgKGV4aXN0aW5nVXNlcikge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnVXNlciB3aXRoIHRoaXMgZW1haWwgYWxyZWFkeSBleGlzdHMnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEhhc2ggcGFzc3dvcmRcclxuICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgaGFzaFBhc3N3b3JkKHBhc3N3b3JkKTtcclxuXHJcbiAgICBjb25zdCB1c2VyID0gbmV3IFVzZXIoe1xyXG4gICAgICBlbWFpbCxcclxuICAgICAgZmlyc3ROYW1lLFxyXG4gICAgICBsYXN0TmFtZSxcclxuICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxyXG4gICAgICByb2xlLFxyXG4gICAgICBwaG9uZSxcclxuICAgICAgYmlvLFxyXG4gICAgICBwcmVmZXJlbmNlczoge1xyXG4gICAgICAgIGludGVyZXN0czogW10sXHJcbiAgICAgICAgcHJlZmVycmVkTGFuZ3VhZ2U6ICdlbicsXHJcbiAgICAgICAgbm90aWZpY2F0aW9uczogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCB1c2VyLnNhdmUoKTtcclxuXHJcbiAgICAvLyBSZXR1cm4gdXNlciB3aXRob3V0IHBhc3N3b3JkXHJcbiAgICBjb25zdCB1c2VyUmVzcG9uc2UgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXIuX2lkKS5zZWxlY3QoJy1wYXNzd29yZCcpO1xyXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oeyB1c2VyOiB1c2VyUmVzcG9uc2UgfSk7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGUubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGNyZWF0ZSB1c2VyJyB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gVXBkYXRlIHVzZXIgYnkgSUQgKGFkbWluIG9ubHkpXHJcbnJvdXRlci5wdXQoJy91c2Vycy86aWQnLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIGNvbnN0IHsgZW1haWwsIGZpcnN0TmFtZSwgbGFzdE5hbWUsIHJvbGUsIHBob25lLCBiaW8sIHByZWZlcmVuY2VzIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7fTtcclxuICAgIGlmIChlbWFpbCAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmVtYWlsID0gZW1haWw7XHJcbiAgICBpZiAoZmlyc3ROYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuZmlyc3ROYW1lID0gZmlyc3ROYW1lO1xyXG4gICAgaWYgKGxhc3ROYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEubGFzdE5hbWUgPSBsYXN0TmFtZTtcclxuICAgIGlmIChyb2xlICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEucm9sZSA9IHJvbGU7XHJcbiAgICBpZiAocGhvbmUgIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5waG9uZSA9IHBob25lO1xyXG4gICAgaWYgKGJpbyAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLmJpbyA9IGJpbztcclxuICAgIGlmIChwcmVmZXJlbmNlcyAhPT0gdW5kZWZpbmVkKSB1cGRhdGVEYXRhLnByZWZlcmVuY2VzID0gcHJlZmVyZW5jZXM7XHJcblxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUoXHJcbiAgICAgIGlkLFxyXG4gICAgICB1cGRhdGVEYXRhLFxyXG4gICAgICB7IG5ldzogdHJ1ZSwgcnVuVmFsaWRhdG9yczogdHJ1ZSB9XHJcbiAgICApLnNlbGVjdCgnLXBhc3N3b3JkJyk7XHJcblxyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVzLmpzb24oeyB1c2VyIH0pO1xyXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgdXNlcicgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIERlbGV0ZSB1c2VyIGJ5IElEIChhZG1pbiBvbmx5KVxyXG5yb3V0ZXIuZGVsZXRlKCcvdXNlcnMvOmlkJywgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlKCdhZG1pbicpLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcblxyXG4gICAgLy8gUHJldmVudCBkZWxldGluZyBhZG1pbiB1c2Vyc1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQoaWQpO1xyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnQ2Fubm90IGRlbGV0ZSBhZG1pbiB1c2VycycgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgVXNlci5maW5kQnlJZEFuZERlbGV0ZShpZCk7XHJcbiAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdVc2VyIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZGVsZXRlIHVzZXInIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBHZXQgc2luZ2xlIHVzZXIgYnkgSUQgKGFkbWluIG9ubHkpXHJcbnJvdXRlci5nZXQoJy91c2Vycy86aWQnLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKGlkKS5zZWxlY3QoJy1wYXNzd29yZCcpO1xyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcgfSk7XHJcbiAgICB9XHJcbiAgICByZXMuanNvbih7IHVzZXIgfSk7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGUubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGZldGNoIHVzZXInIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBDb3Vyc2UgQ1JVRFxyXG5yb3V0ZXIucG9zdCgnL2NvdXJzZXMnLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB0aXRsZSwgZGVzY3JpcHRpb24sIHRodW1ibmFpbCwgY2F0ZWdvcnksIHByaWNlLCBsZXZlbCwgZHVyYXRpb24sIGxhbmd1YWdlLCB0YWdzLCBtb2R1bGVzIH0gPSByZXEuYm9keTtcclxuICAgIGNvbnN0IHVzZXIgPSAocmVxIGFzIGFueSkudXNlcjtcclxuXHJcbiAgICBjb25zdCBjb3Vyc2UgPSBuZXcgQ291cnNlKHtcclxuICAgICAgdGl0bGUsXHJcbiAgICAgIGRlc2NyaXB0aW9uLFxyXG4gICAgICB0aHVtYm5haWwsXHJcbiAgICAgIGNhdGVnb3J5LFxyXG4gICAgICBwcmljZTogTnVtYmVyKHByaWNlKSxcclxuICAgICAgbGV2ZWwsXHJcbiAgICAgIGR1cmF0aW9uOiBOdW1iZXIoZHVyYXRpb24pLFxyXG4gICAgICBsYW5ndWFnZSxcclxuICAgICAgdGFnczogdGFncyB8fCBbXSxcclxuICAgICAgbW9kdWxlczogbW9kdWxlcyB8fCBbXSxcclxuICAgICAgaXNQdWJsaXNoZWQ6IHRydWVcclxuICAgIH0pO1xyXG5cclxuICAgIGF3YWl0IGNvdXJzZS5zYXZlKCk7XHJcbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7IGNvdXJzZSB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gY3JlYXRlIGNvdXJzZScgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbnJvdXRlci5wdXQoJy9jb3Vyc2VzLzppZCcsIHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSgnYWRtaW4nKSwgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgY29uc3QgdXBkYXRlcyA9IHJlcS5ib2R5O1xyXG5cclxuICAgIGNvbnN0IGNvdXJzZSA9IGF3YWl0IENvdXJzZS5maW5kQnlJZEFuZFVwZGF0ZShpZCwgdXBkYXRlcywgeyBuZXc6IHRydWUgfSk7XHJcblxyXG4gICAgaWYgKCFjb3Vyc2UpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0NvdXJzZSBub3QgZm91bmQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcy5qc29uKHsgY291cnNlIH0pO1xyXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgY291cnNlJyB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxucm91dGVyLmRlbGV0ZSgnL2NvdXJzZXMvOmlkJywgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlKCdhZG1pbicpLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBhd2FpdCBDb3Vyc2UuZmluZEJ5SWRBbmREZWxldGUoaWQpO1xyXG4gICAgcmVzLmpzb24oeyBtZXNzYWdlOiAnQ291cnNlIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZGVsZXRlIGNvdXJzZScgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIEVucm9sbG1lbnRzL1BheW1lbnRzXHJcbnJvdXRlci5nZXQoJy9lbnJvbGxtZW50cycsIHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSgnYWRtaW4nKSwgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHBhZ2UgPSAxLCBsaW1pdCA9IDEwIH0gPSByZXEucXVlcnk7XHJcbiAgICBjb25zdCBza2lwID0gKE51bWJlcihwYWdlKSAtIDEpICogTnVtYmVyKGxpbWl0KTtcclxuXHJcbiAgICBjb25zdCBlbnJvbGxtZW50cyA9IGF3YWl0IEVucm9sbG1lbnQuZmluZCh7fSlcclxuICAgICAgLnBvcHVsYXRlKCdzdHVkZW50JywgJ2ZpcnN0TmFtZSBsYXN0TmFtZSBlbWFpbCcpXHJcbiAgICAgIC5wb3B1bGF0ZSgnY291cnNlJywgJ3RpdGxlIHByaWNlJylcclxuICAgICAgLnNvcnQoeyBlbnJvbGxtZW50RGF0ZTogLTEgfSlcclxuICAgICAgLnNraXAoc2tpcClcclxuICAgICAgLmxpbWl0KE51bWJlcihsaW1pdCkpO1xyXG5cclxuICAgIGNvbnN0IHRvdGFsID0gYXdhaXQgRW5yb2xsbWVudC5jb3VudERvY3VtZW50cygpO1xyXG5cclxuICAgIHJlcy5qc29uKHsgZW5yb2xsbWVudHMsIHRvdGFsLCBwYWdlOiBOdW1iZXIocGFnZSksIHBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBOdW1iZXIobGltaXQpKSB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2ggZW5yb2xsbWVudHMnIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBBbm5vdW5jZW1lbnRzXHJcbnJvdXRlci5nZXQoJy9hbm5vdW5jZW1lbnRzJywgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlKCdhZG1pbicpLCBhc3luYyAoX3JlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBhbm5vdW5jZW1lbnRzID0gYXdhaXQgQW5ub3VuY2VtZW50LmZpbmQoe30pXHJcbiAgICAgIC5wb3B1bGF0ZSgnY3JlYXRlZEJ5JywgJ2ZpcnN0TmFtZSBsYXN0TmFtZScpXHJcbiAgICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KTtcclxuXHJcbiAgICByZXMuanNvbih7IGFubm91bmNlbWVudHMgfSk7XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGUubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGZldGNoIGFubm91bmNlbWVudHMnIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG5yb3V0ZXIucG9zdCgnL2Fubm91bmNlbWVudHMnLCByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUoJ2FkbWluJyksIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyB0aXRsZSwgbWVzc2FnZSwgdHlwZSB9ID0gcmVxLmJvZHk7XHJcbiAgICBjb25zdCB1c2VyID0gKHJlcSBhcyBhbnkpLnVzZXI7XHJcblxyXG4gICAgY29uc3QgYW5ub3VuY2VtZW50ID0gbmV3IEFubm91bmNlbWVudCh7XHJcbiAgICAgIHRpdGxlLFxyXG4gICAgICBtZXNzYWdlLFxyXG4gICAgICB0eXBlOiB0eXBlIHx8ICdpbmZvJyxcclxuICAgICAgY3JlYXRlZEJ5OiB1c2VyLnVzZXJJZFxyXG4gICAgfSk7XHJcblxyXG4gICAgYXdhaXQgYW5ub3VuY2VtZW50LnNhdmUoKTtcclxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHsgYW5ub3VuY2VtZW50IH0pO1xyXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgYW5ub3VuY2VtZW50JyB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxucm91dGVyLnB1dCgnL2Fubm91bmNlbWVudHMvOmlkJywgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlKCdhZG1pbicpLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBjb25zdCB7IHRpdGxlLCBtZXNzYWdlLCB0eXBlLCBpc0FjdGl2ZSB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgY29uc3QgYW5ub3VuY2VtZW50ID0gYXdhaXQgQW5ub3VuY2VtZW50LmZpbmRCeUlkQW5kVXBkYXRlKGlkLCB7XHJcbiAgICAgIHRpdGxlLFxyXG4gICAgICBtZXNzYWdlLFxyXG4gICAgICB0eXBlLFxyXG4gICAgICBpc0FjdGl2ZVxyXG4gICAgfSwgeyBuZXc6IHRydWUgfSk7XHJcblxyXG4gICAgaWYgKCFhbm5vdW5jZW1lbnQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0Fubm91bmNlbWVudCBub3QgZm91bmQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcy5qc29uKHsgYW5ub3VuY2VtZW50IH0pO1xyXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiBlLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byB1cGRhdGUgYW5ub3VuY2VtZW50JyB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxucm91dGVyLmRlbGV0ZSgnL2Fubm91bmNlbWVudHMvOmlkJywgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlKCdhZG1pbicpLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBhd2FpdCBBbm5vdW5jZW1lbnQuZmluZEJ5SWRBbmREZWxldGUoaWQpO1xyXG4gICAgcmVzLmpzb24oeyBtZXNzYWdlOiAnQW5ub3VuY2VtZW50IGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZGVsZXRlIGFubm91bmNlbWVudCcgfSk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIFNldHRpbmdzIC0gQ2hhbmdlIHBhc3N3b3JkXHJcbnJvdXRlci5wdXQoJy9zZXR0aW5ncy9wYXNzd29yZCcsIHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSgnYWRtaW4nKSwgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGN1cnJlbnRQYXNzd29yZCwgbmV3UGFzc3dvcmQgfSA9IHJlcS5ib2R5O1xyXG4gICAgY29uc3QgdXNlciA9IChyZXEgYXMgYW55KS51c2VyO1xyXG5cclxuICAgIGNvbnN0IGFkbWluVXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodXNlci51c2VySWQpO1xyXG4gICAgaWYgKCFhZG1pblVzZXIpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgY29tcGFyZVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZCwgYWRtaW5Vc2VyLnBhc3N3b3JkKTtcclxuICAgIGlmICghaXNNYXRjaCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnQ3VycmVudCBwYXNzd29yZCBpcyBpbmNvcnJlY3QnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGhhc2hlZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZCk7XHJcbiAgICBhZG1pblVzZXIucGFzc3dvcmQgPSBoYXNoZWQ7XHJcbiAgICBhd2FpdCBhZG1pblVzZXIuc2F2ZSgpO1xyXG5cclxuICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ1Bhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gdXBkYXRlIHBhc3N3b3JkJyB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xyXG4iXX0=