import { Router } from 'express';
import { requireAuth, requireRole } from '../middleware/auth.ts';
import { User } from '../models/User.ts';
import { Enrollment } from '../models/Enrollment.ts';
import { Course } from '../models/Course.ts';
import { userProfileValidation, changePasswordValidation, validate } from '../utils/Validators.ts';
const router = Router();
// Get current user profile
router.get('/me', requireAuth, async (req, res) => {
    const uid = req.user?.userId;
    const u = await User.findById(uid).select('_id email firstName lastName bio profilePicture phone preferences role createdAt updatedAt');
    if (!u)
        return res.status(404).json({ message: 'User not found' });
    res.json(u);
});
// Update current user profile
router.put('/me', requireAuth, validate(userProfileValidation), async (req, res) => {
    const uid = req.user?.userId;
    const { firstName, lastName, bio, profilePicture, phone, email, preferences } = req.body || {};
    const update = { firstName, lastName, bio, profilePicture, phone, preferences };
    if (email)
        update.email = email;
    const updated = await User.findByIdAndUpdate(uid, update, { new: true, runValidators: true }).select('email firstName lastName bio profilePicture phone preferences role createdAt updatedAt');
    if (!updated)
        return res.status(404).json({ message: 'User not found' });
    res.json(updated);
});
// Change password
router.put('/me/password', requireAuth, validate(changePasswordValidation), async (req, res) => {
    const uid = req.user?.userId;
    const { currentPassword, newPassword } = req.body || {};
    if (!newPassword)
        return res.status(400).json({ message: 'newPassword is required' });
    const u = await User.findById(uid).select('password');
    if (!u)
        return res.status(404).json({ message: 'User not found' });
    try {
        const { comparePassword, hashPassword } = await import('../utils/Passwordhash.ts');
        if (currentPassword) {
            const ok = await comparePassword(currentPassword, u.password);
            if (!ok)
                return res.status(400).json({ message: 'Current password is incorrect' });
        }
        const hashed = await hashPassword(newPassword);
        await User.findByIdAndUpdate(uid, { password: hashed });
        return res.json({ ok: true });
    }
    catch (e) {
        return res.status(500).json({ message: 'Server error' });
    }
});
// Admin: list users
router.get('/', requireAuth, requireRole('admin'), async (_req, res) => {
    const list = await User.find({}).select('email firstName lastName role createdAt');
    res.json(list);
});
// Admin or self: get a user's course-related details (enrollments)
router.get('/:id/enrollments', requireAuth, async (req, res) => {
    const requester = req.user;
    const { id } = req.params;
    if (requester.userId !== id && requester.role !== 'admin') {
        return res.status(403).json({ message: 'Forbidden' });
    }
    const enrollments = await Enrollment.find({ student: id })
        .populate({ path: 'course', model: Course, select: 'title price category thumbnail' })
        .select('status progress enrollmentDate completionDate');
    res.json(enrollments);
});
export default router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcm91dGVzL3VzZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFakMsT0FBTyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDekMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3JELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsd0JBQXdCLEVBQUUsUUFBUSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFbkcsTUFBTSxNQUFNLEdBQUcsTUFBTSxFQUFFLENBQUM7QUFFeEIsMkJBQTJCO0FBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsR0FBWSxFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQ25FLE1BQU0sR0FBRyxHQUFJLEdBQVcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDO0lBQ3RDLE1BQU0sQ0FBQyxHQUFHLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsNEZBQTRGLENBQUMsQ0FBQztJQUN4SSxJQUFJLENBQUMsQ0FBQztRQUFFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO0lBQ25FLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDZCxDQUFDLENBQUMsQ0FBQztBQUVILDhCQUE4QjtBQUM5QixNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxXQUFXLEVB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RSxnQ0FBZ0MsRUFBRSxDQUFDO1NBQ3JGLE1BQU0sQ0FBQywrQ0FBK0MsQ0FBQyxDQUFDO0lBQzNELEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDeEIsQ0FBQyxDQUFDLENBQUM7QUFFSCxlQUFlLE1BQU0sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgdHlwZSB7IFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCB7IHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSB9IGZyb20gJy4uL21pZGRsZXdhcmUvYXV0aC50cyc7XHJcbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuLi9tb2RlbHMvVXNlci50cyc7XHJcbmltcG9ydCB7IEVucm9sbG1lbnQgfSBmcm9tICcuLi9tb2RlbHMvRW5yb2xsbWVudC50cyc7XHJcbmltcG9ydCB7IENvdXJzZSB9IGZyb20gJy4uL21vZGVscy9Db3Vyc2UudHMnO1xyXG5pbXBvcnQgeyB1c2VyUHJvZmlsZVZhbGlkYXRpb24sIGNoYW5nZVBhc3N3b3JkVmFsaWRhdGlvbiwgdmFsaWRhdGUgfSBmcm9tICcuLi91dGlscy9WYWxpZGF0b3JzLnRzJztcclxuXHJcbmNvbnN0IHJvdXRlciA9IFJvdXRlcigpO1xyXG5cclxuLy8gR2V0IGN1cnJlbnQgdXNlciBwcm9maWxlXHJcbnJvdXRlci5nZXQoJy9tZScsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgY29uc3QgdWlkID0gKHJlcSBhcyBhbnkpLnVzZXI/LnVzZXJJZDtcclxuICBjb25zdCB1ID0gYXdhaXQgVXNlci5maW5kQnlJZCh1aWQpLnNlbGVjdCgnX2lkIGVtYWlsIGZpcnN0TmFtZSBsYXN0TmFtZSBiaW8gcHJvZmlsZVBpY3R1cmUgcGhvbmUgcHJlZmVyZW5jZXMgcm9sZSBjcmVhdGVkQXQgdXBkYXRlZEF0Jyk7XHJcbiAgaWYgKCF1KSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG4gIHJlcy5qc29uKHUpO1xyXG59KTtcclxuXHJcbi8vIFVwZGF0ZSBjdXJyZW50IHVzZXIgcHJvZmlsZVxyXG5yb3V0ZXIucHV0KCcvbWUnLCByZXF1aXJlQXV0aCwgdmFsaWRhdGUodXNlclByb2ZpbGVWYWxpZGF0aW9uKSwgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIGNvbnN0IHVpZCA9IChyZXEgYXMgYW55KS51c2VyPy51c2VySWQ7XHJcbiAgY29uc3QgeyBmaXJzdE5hbWUsIGxhc3ROYW1lLCBiaW8sIHByb2ZpbGVQaWN0dXJlLCBwaG9uZSwgZW1haWwsIHByZWZlcmVuY2VzIH0gPSByZXEuYm9keSB8fCB7fTtcclxuICBjb25zdCB1cGRhdGU6IGFueSA9IHsgZmlyc3ROYW1lLCBsYXN0TmFtZSwgYmlvLCBwcm9maWxlUGljdHVyZSwgcGhvbmUsIHByZWZlcmVuY2VzIH07XHJcbiAgaWYgKGVtYWlsKSB1cGRhdGUuZW1haWwgPSBlbWFpbDtcclxuICBjb25zdCB1cGRhdGVkID0gYXdhaXQgVXNlci5maW5kQnlJZEFuZFVwZGF0ZShcclxuICAgIHVpZCxcclxuICAgIHVwZGF0ZSxcclxuICAgIHsgbmV3OiB0cnVlLCBydW5WYWxpZGF0b3JzOiB0cnVlIH1cclxuICApLnNlbGVjdCgnZW1haWwgZmlyc3ROYW1lIGxhc3ROYW1lIGJpbyBwcm9maWxlUGljdHVyZSBwaG9uZSBwcmVmZXJlbmNlcyByb2xlIGNyZWF0ZWRBdCB1cGRhdGVkQXQnKTtcclxuICBpZiAoIXVwZGF0ZWQpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcgfSk7XHJcbiAgcmVzLmpzb24odXBkYXRlZCk7XHJcbn0pO1xyXG5cclxuLy8gQ2hhbmdlIHBhc3N3b3JkXHJcbnJvdXRlci5wdXQoJy9tZS9wYXNzd29yZCcsIHJlcXVpcmVBdXRoLCB2YWxpZGF0ZShjaGFuZ2VQYXNzd29yZFZhbGlkYXRpb24pLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XHJcbiAgY29uc3QgdWlkID0gKHJlcSBhcyBhbnkpLnVzZXI/LnVzZXJJZDtcclxuICBjb25zdCB7IGN1cnJlbnRQYXNzd29yZCwgbmV3UGFzc3dvcmQgfSA9IHJlcS5ib2R5IHx8IHt9O1xyXG4gIGlmICghbmV3UGFzc3dvcmQpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICduZXdQYXNzd29yZCBpcyByZXF1aXJlZCcgfSk7XHJcbiAgY29uc3QgdSA9IGF3YWl0IFVzZXIuZmluZEJ5SWQodWlkKS5zZWxlY3QoJ3Bhc3N3b3JkJyk7XHJcbiAgaWYgKCF1KSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnIH0pO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGNvbXBhcmVQYXNzd29yZCwgaGFzaFBhc3N3b3JkIH0gPSBhd2FpdCBpbXBvcnQoJy4uL3V0aWxzL1Bhc3N3b3JkaGFzaC50cycpO1xyXG4gICAgaWYgKGN1cnJlbnRQYXNzd29yZCkge1xyXG4gICAgICBjb25zdCBvayA9IGF3YWl0IGNvbXBhcmVQYXNzd29yZChjdXJyZW50UGFzc3dvcmQsICh1IGFzIGFueSkucGFzc3dvcmQpO1xyXG4gICAgICBpZiAoIW9rKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnQ3VycmVudCBwYXNzd29yZCBpcyBpbmNvcnJlY3QnIH0pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaGFzaGVkID0gYXdhaXQgaGFzaFBhc3N3b3JkKG5ld1Bhc3N3b3JkKTtcclxuICAgIGF3YWl0IFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUodWlkLCB7IHBhc3N3b3JkOiBoYXNoZWQgfSk7XHJcbiAgICByZXR1cm4gcmVzLmpzb24oeyBvazogdHJ1ZSB9KTtcclxuICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBBZG1pbjogbGlzdCB1c2Vyc1xyXG5yb3V0ZXIuZ2V0KCcvJywgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlKCdhZG1pbicpLCBhc3luYyAoX3JlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xyXG4gIGNvbnN0IGxpc3QgPSBhd2FpdCBVc2VyLmZpbmQoe30pLnNlbGVjdCgnZW1haWwgZmlyc3ROYW1lIGxhc3ROYW1lIHJvbGUgY3JlYXRlZEF0Jyk7XHJcbiAgcmVzLmpzb24obGlzdCk7XHJcbn0pO1xyXG5cclxuLy8gQWRtaW4gb3Igc2VsZjogZ2V0IGEgdXNlcidzIGNvdXJzZS1yZWxhdGVkIGRldGFpbHMgKGVucm9sbG1lbnRzKVxyXG5yb3V0ZXIuZ2V0KCcvOmlkL2Vucm9sbG1lbnRzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcclxuICBjb25zdCByZXF1ZXN0ZXIgPSAocmVxIGFzIGFueSkudXNlciBhcyB7IHVzZXJJZDogc3RyaW5nOyByb2xlOiBzdHJpbmcgfTtcclxuICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xyXG4gIGlmIChyZXF1ZXN0ZXIudXNlcklkICE9PSBpZCAmJiByZXF1ZXN0ZXIucm9sZSAhPT0gJ2FkbWluJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ0ZvcmJpZGRlbicgfSk7XHJcbiAgfVxyXG4gIGNvbnN0IGVucm9sbG1lbnRzID0gYXdhaXQgRW5yb2xsbWVudC5maW5kKHsgc3R1ZGVudDogaWQgfSlcclxuICAgIC5wb3B1bGF0ZSh7IHBhdGg6ICdjb3Vyc2UnLCBtb2RlbDogQ291cnNlLCBzZWxlY3Q6ICd0aXRsZSBwcmljZSBjYXRlZ29yeSB0aHVtYm5haWwnIH0pXHJcbiAgICAuc2VsZWN0KCdzdGF0dXMgcHJvZ3Jlc3MgZW5yb2xsbWVudERhdGUgY29tcGxldGlvbkRhdGUnKTtcclxuICByZXMuanNvbihlbnJvbGxtZW50cyk7XHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xyXG4iXX0=